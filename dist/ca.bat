0</*! :: See https://github.com/ukoloff/directum
@echo off
cscript.exe //nologo //e:javascript "%~f0" %* Directum/Directum
goto :EOF */0;
!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){(function(t,n,r){t?(n("Загрузка пользовательских сертификатов Directum v1.0.0 <https://github.com/ukoloff/directum>\n"),e(39)):r(e(38))}).call(n,e(1),e(2),e(51))},function(t,n){t.exports="undefined"!=typeof WScript&&null!==WScript?WScript:null},function(t,n,e){(function(n){t.exports=function(){return n.Echo([].slice.apply(arguments).join(" "))}}).call(n,e(1))},function(t,n){t.exports=new ActiveXObject("WScript.Shell")},function(t,n){t.exports=function(t,n){var e,r,o;for("function"!=typeof n&&(o=[]),r=0,e=new Enumerator(t);!e.atEnd();){if(o)o.push(e.item());else if(!1===n(e.item(),r++))return;e.moveNext()}return o}},function(t,n){t.exports=new ActiveXObject("Scripting.FileSystemObject")},function(t,n,e){(function(t){var n,e,r;e=this.h,this.connect=function(t,n){return this.h=e=new ActiveXObject("ADODB.Connection"),e.Provider="SQLOLEDB",e.Open("Integrated Security=SSPI;Data Source="+t),n&&r(n),e},this.use=r=function(t){return e.DefaultDatabase="["+t+"]"},this.command=function(t){var n;return n=new ActiveXObject("ADODB.Command"),n.ActiveConnection=e,n.CommandText=t,n},this.fields=n=function(n){var e;if(!n.EOF)return e={},t(n.Fields,function(t){e[t.name]=t.value}),e},this.execute=function(t,e){var r,o,i,c;for(o=0,"function"!=typeof e&&(i=[]),c=t.Execute();!c.EOF;)if(r=n(c),c.MoveNext(),i)i.push(r);else if(!1===e(r,o++))return;return i}}).call(n,e(4))},function(t,n){var e,r,o=[].slice;t.exports=r=new Function("o,k,v","o(k)=v"),r.a=e=function(t,n){var e,o,i,c;for(e=o=0,i=n.length;i>o;e=++o)c=n[e],r(t,e,c);return t},r.l=function(){var t,n;return n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],e(n,t)},r.o=function(t,n){var e,o,i,c;for(c=e=0,i=n.length;i>e;c=++e)o=n[c],r(t,o,c);return t}},function(t,n,e){(function(n){t.exports=function(t){return null==t&&(t=0),n.Quit(t)}}).call(n,e(1))},function(t,n,e){(function(n,e){t.exports=n(e.Arguments)}).call(n,e(4),e(1))},function(t,n){t.exports=function(t){var n,e;for(null==t&&(t=12),e="";e.length<t;)n=Math.floor(62*Math.random()),e+=String.fromCharCode("Aa0".charCodeAt(n/26)+n%26);return e}},,,function(t,n,e){(function(n,e,r,o){var i,c;i=function(){return n("Запуск: "+e.ScriptName+" <Server>/<Database>\n\nНапример: "+e.ScriptName+" Directum/Directum\n\nУмолчания можно дописать в 3 строку файла.\n\nПодробности на <https://github.com/ukoloff/directum>."),r(1)},t.exports=c=function(){var t,n,e;for(o.length||i(),t=0,n=o.length;n>t;t++)e=o[t],/^\w+\/\w+/.test(e)||i();return e=o[0].split("/"),{s:e[0],d:e[1]}}()}).call(n,e(2),e(1),e(8),e(9))},function(t,n,e){(function(n,e,r){var o;o=n.ExpandEnvironmentStrings("%TEMP%"),t.exports=function(){var t,n,i;for(t=n=1;16>=n;t=++n)if(!e.FileExists(i=e.BuildPath(o,r())))return i;throw Error("Cannot create temporary file")}}).call(n,e(3),e(5),e(10))},,,,,,,function(t,n,e){(function(n,e,r){t.exports=function(){var t,o,i,c,u,a;for(u="",c=["(x86)",""],t=0,o=c.length;o>t;t++)if(a=c[t],i=n.ExpandEnvironmentStrings("%ProgramFiles"+a+"%")){try{i=e.GetFolder(e.BuildPath(i,"DIRECTUM Company"))}catch(f){continue}r(i.SubFolders,function(t){return i=e.BuildPath(t.Path,"SBLauncher.exe"),e.FileExists(i)?u=i:void 0})}return u}()}).call(n,e(3),e(5),e(4))},,,,,,,,,,,,,,,,,function(t,n,e){(function(t,n,e,r,o,i,c,u){var a,f,l,s,p,d,h,m;a=0,m={},l=[],f={},s={},h=0,p=0,d=0,this.init=function(t,i){var c;return a=t,c=a.Connection,n.connect(c.ServerName,c.DatabaseName),l=e(r.get("https://ekb.ru/omz/abook/pki/?q=r@;u!@&sort=C&as=csv&rnd="+o()))},this.next=function(){for(f.ТекстТ2&&i.DeleteFile(f.ТекстТ2);m=l.shift();)if(!m.Revoke&&m.u&&(h||(h=n.command("Select\n  UserLogin, UserKod, UserName, P.Analit, P.Kod\nFrom\n  mbUser U, mbAnalit P, mbVidAn V\nWhere\n  U.NeedEncode='W' And U.UserKod=P.Dop And\n  P.Vid=V.Vid And V.Kod='ПОЛ'\n  And U.UserLogin=?")),c.l(h,m.u),(s=n.fields(h.Execute()))&&(s.cn=m.subj.replace(/.*\/CN=/i,"").replace(/\/.*/,""),p=n.command("Select Count(*) As N\nFrom MBAnValR2\nWhere\n  Analit=?\n  And SoderT2=?"),c.l(p,s.Analit,s.SHA1=m.SHA1.replace(/\W/g,"")),!p.Execute()(0).value)))return!0;return!1},this.item=function(){var t;return r.dl("https://ekb.ru/omz/abook/pki/?as=der&n="+m.id,t=u()),d||(d=n.command("Update MBAnValR2\n  Set DefaultCert='Н', CertificateType='Э'\nWhere\n  Analit=?")),c.l(d,s.Analit).Execute(),f={u:m.u,Kod:s.Kod,Analit:s.Analit,ISBStartObjectName:"{B1B27433-D685-47F8-8500-CF9525407145}","СтрокаТ2":s.cn,"СодержаниеТ2":s.SHA1,"ТекстТ2":t,ISBCertificateInfo:s.UserName,ISBCertificateType:"ЭЦП и шифрование",ISBDefaultCert:"Да","СостояниеТ2":"Действующая"}}}).call(n,e(52),e(6),e(48),e(46),e(10),e(5),e(7),e(14))},function(t,n,e){(function(t,n,e,r,o){var i;if(!t)throw Error("SBLauncher.exe not found!");i=n.ScriptName.replace(/\W+/,"_"),e(r.Environment("Process"),i.toUpperCase(),n.ScriptFullName),r.Run('"'+t+'" -S='+o.s+" -D="+o.d+" -CT=Script -F="+i)}).call(n,e(21),e(1),e(7),e(3),e(13))},,,,,,,function(t,n){var e,r;e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"],t.exports=r=function(){var t,n,r;for(t=0,n=e.length;n>t;t++){r=e[t];try{return new ActiveXObject(r)}catch(o){}}throw Error("AJAX not supported!")},r.get=function(t,n){var e;if(e=r(),e.open("GET",t,!1),e.send(null),200!==e.status)throw Error("HTTP error "+e.status+": "+e.statusText);return n?e.responseBody:e.responseText},r.dl=function(t,n){var e,o;return e=r.get(t,!0),o=new ActiveXObject("adodb.stream"),o.Type=1,o.Open(),o.Write(e),o.SaveToFile(n,2),o.Close()}},,function(t,n){var e,r,o;t.exports=o=function(t){return e(r(t))},r=function(t){var n,e,r,o,i,c;for(e="",n=[],i=[],c=function(n){return n.test(t),e+=RegExp.leftContext,t=RegExp.rightContext};t.length;){if(o)switch(c(/""?|$/),RegExp.lastMatch){case'"':o=!1;continue;case'""':e+='"';continue;case"":r=!0}else{if(c(/;|"|\r\n?|\n|$/),'"'===RegExp.lastMatch){o=!0;continue}r=";"!==RegExp.lastMatch}n.push(e),e="",r&&(i.push(n),n=[])}return i},e=function(t){var n,e,r,o,i,c,u,a,f,l;for(l=[],r=0,i=t.length;i>r;r++)if(u=t[r],u.length>1||u[0].length>0)if(n)for(l.push(f={}),e=o=0,c=n.length;c>o;e=++o)a=n[e],f[a]=u[e];else n=u;return l}},,,function(t,n){t.exports=function(t){return function(){var n,e;for(n in t)e=t[n],this[n]=e}()}},function(t,n,e){(function(t){t.RegWrite("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\CertificateRevocation",0,"REG_DWORD")}).call(n,e(3))}]);
